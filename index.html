<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ä»£è³¼æ™ºæ…§ç®¡å®¶ 24.0 | é›²ç«¯é€£å‹•ç‰ˆ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;700&display=swap');
        body { font-family: 'Noto Sans TC', sans-serif; background-color: #fcfafb; margin: 0; display: flex; }
        .sidebar { width: 260px; background: white; border-right: 1px solid #f1f5f9; min-height: 100vh; position: fixed; top: 0; left: 0; z-index: 50; transition: transform 0.3s ease; }
        @media (max-width: 768px) { .sidebar { transform: translateX(-100%); } .sidebar.active { transform: translateX(0); } .main-content { margin-left: 0 !important; } }
        .main-content { margin-left: 260px; width: 100%; }
        .nav-item { padding: 12px 20px; border-radius: 12px; cursor: pointer; color: #64748b; font-size: 14px; margin-bottom: 5px; }
        .nav-item:hover, .nav-item.active { background: #fff1f2; color: #e11d48; font-weight: bold; }
        .glass-card { background: white; border-radius: 1.5rem; box-shadow: 0 4px 20px rgba(0,0,0,0.03); border: 1px solid #f8fafc; }
        .modal { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.6); z-index: 2000; align-items: center; justify-content: center; backdrop-filter: blur(8px); padding: 20px; }
        .modal.active { display: flex; }
        .status-select { border-radius: 6px; font-size: 11px; padding: 4px 10px; font-weight: bold; border: none; cursor: pointer; }
    </style>
</head>
<body class="flex">

    <header class="md:hidden fixed top-0 left-0 right-0 bg-white border-b p-4 flex items-center justify-between z-40">
        <button onclick="toggleSidebar()" class="text-rose-500 text-2xl"><i class="fas fa-bars"></i></button>
        <span class="font-bold text-rose-500">ä»£è³¼æ™ºæ…§ç®¡å®¶</span>
        <div class="w-8"></div>
    </header>

    <aside id="sidebar" class="sidebar p-5 flex flex-col">
        <div class="text-rose-500 font-bold text-xl px-2 mb-8 hidden md:flex items-center"><i class="fas fa-cloud mr-2"></i>ä»£è³¼ç®¡å®¶ 24.0</div>
        <nav class="flex-1 space-y-1 overflow-y-auto">
            <div onclick="changeView('dashboard')" id="nav-dashboard" class="nav-item active"><i class="fas fa-th-large mr-3"></i> ç¸½é«”çœ‹æ¿</div>
            <div class="mt-6 px-4 text-[10px] font-bold text-gray-400 uppercase tracking-widest">ğŸ“‹ åœ˜å‹™ç®¡ç†</div>
            <div id="side-group-list" class="mt-2 space-y-1"></div>
            <div onclick="openModal('groupModal')" class="px-5 py-2 text-rose-400 text-[11px] font-bold cursor-pointer hover:underline">+ æ–°å¢åœ˜å‹™é é¢</div>
            <div class="mt-6 px-4 text-[10px] font-bold text-gray-400 uppercase tracking-widest">âš™ï¸ ç³»çµ±è¨­å®š</div>
            <div onclick="changeView('settings')" id="nav-settings" class="nav-item"><i class="fas fa-cog mr-3"></i> é›²ç«¯é€£å‹•è¨­å®š</div>
        </nav>
        <button onclick="openModal('searchModal')" class="w-full bg-rose-500 text-white p-4 rounded-2xl text-xs font-bold shadow-lg"><i class="fas fa-search mr-2"></i>è·¨åœ˜ç—…æ­·</button>
    </aside>

    <div id="sidebar-overlay" onclick="toggleSidebar()" class="hidden fixed inset-0 bg-black/30 z-40 md:hidden"></div>

    <main class="main-content p-6 md:p-10 pt-20 md:pt-10">
        <div id="view-dashboard" class="max-w-6xl mx-auto space-y-6">
            <div class="flex justify-between items-center">
                <h2 class="text-2xl font-bold">æ´»èºåœ˜å‹™çœ‹æ¿</h2>
                <div id="sync-status" class="text-[10px] text-gray-400 italic"></div>
            </div>
            <div class="glass-card overflow-x-auto">
                <table class="w-full text-left text-sm min-w-[700px]">
                    <thead class="bg-gray-50 text-gray-400 font-bold text-[10px] uppercase">
                        <tr><th class="p-4">åœ˜å‹™åç¨±</th><th class="p-4">é€²åº¦</th><th class="p-4 text-center">æ—¥æœŸ</th><th class="p-4 text-center">ç®¡ç†</th></tr>
                    </thead>
                    <tbody id="dashboard-tbody" class="divide-y divide-gray-100"></tbody>
                </table>
            </div>
        </div>

        <div id="view-settings" class="hidden max-w-2xl mx-auto space-y-8">
            <h2 class="text-2xl font-bold text-gray-800">é›²ç«¯é€£å‹•è¨­å®š</h2>
            <div class="glass-card p-8 space-y-6 border-2 border-rose-100">
                <div>
                    <p class="font-bold text-gray-700 mb-2">Google Apps Script API ç¶²å€</p>
                    <input type="text" id="api-url" placeholder="è«‹è²¼ä¸Šæ‚¨çš„ Google éƒ¨ç½²ç¶²å€..." class="w-full p-4 border rounded-2xl text-xs outline-none focus:ring-2 focus:ring-rose-200">
                    <p class="text-[10px] text-gray-400 mt-2 italic">* è³‡æ–™å°‡å­˜å…¥æ‚¨å€‹äººçš„ Google è©¦ç®—è¡¨ï¼Œåˆ¥äººç„¡æ³•æŸ¥çœ‹ã€‚</p>
                </div>
                <div class="grid grid-cols-2 gap-4">
                    <button onclick="uploadToCloud()" class="bg-rose-500 text-white p-4 rounded-2xl font-bold shadow-lg shadow-rose-100"><i class="fas fa-cloud-upload-alt mr-2"></i>ä¸Šå‚³å‚™ä»½è‡³é›²ç«¯</button>
                    <button onclick="downloadFromCloud()" class="bg-indigo-500 text-white p-4 rounded-2xl font-bold shadow-lg shadow-indigo-100"><i class="fas fa-cloud-download-alt mr-2"></i>å¾é›²ç«¯é‚„åŸè³‡æ–™</button>
                </div>
                <button onclick="saveApiUrl()" class="w-full py-3 border-2 border-rose-500 text-rose-500 rounded-2xl font-bold hover:bg-rose-50 transition">å„²å­˜è¨­å®š</button>
            </div>
        </div>

        <div id="view-groupDetail" class="hidden max-w-6xl mx-auto space-y-6">...</div>
    </main>

    <div id="orderModal" class="modal"><div class="bg-white rounded-[2.5rem] w-full max-w-xl p-8 shadow-2xl mx-4 max-h-[90vh] overflow-y-auto">
        <h3 class="text-xl font-bold mb-6">éŒ„å…¥/ç·¨è¼¯è²·å®¶è¨‚å–®</h3>
        <div class="grid grid-cols-2 gap-4 mb-4"><input id="inName" placeholder="è‡‰æ›¸åç¨±" class="border p-4 rounded-xl text-sm"><input id="inSocial" placeholder="ç¤¾ç¾¤åç¨±" class="border p-4 rounded-xl text-sm"></div>
        <div id="p-selector" class="bg-rose-50 p-6 rounded-[2rem] space-y-3 mb-4"></div>
        <div class="flex justify-between font-bold text-rose-600 px-4 text-lg"><span>ç¸½é‡‘é¡ï¼š</span><span id="auto-price">$0</span></div>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4"><input id="inLast" placeholder="æœ«äº”ç¢¼" class="border p-4 rounded-xl text-sm"><input type="date" id="inPayDate" class="border p-4 rounded-xl text-sm"></div>
        <textarea id="inMemo" placeholder="å‚™è¨»å…§å®¹" class="w-full border p-4 rounded-xl text-sm h-20 mb-4"></textarea>
        <div class="flex gap-4 pt-4">
            <button onclick="closeModal('orderModal')" class="flex-1 text-gray-400 font-bold p-4">å–æ¶ˆ</button>
            <button id="btn-save-order" onclick="saveO()" class="flex-1 py-4 bg-rose-500 text-white rounded-2xl font-bold shadow-lg">ç¢ºèªå„²å­˜</button>
        </div>
    </div></div>

    <script>
        let db = JSON.parse(localStorage.getItem('daigo_v24_db')) || { groups: {}, historyGroups: {}, manualShips: [], historyShips: [], apiUrl: "" };
        let editingOrderId = null;

        window.onload = () => { 
            if(db.apiUrl) document.getElementById('api-url').value = db.apiUrl;
            renderSide(); renderDashboard(); 
        };

        function save() { localStorage.setItem('daigo_v24_db', JSON.stringify(db)); }
        function saveApiUrl() { db.apiUrl = document.getElementById('api-url').value; save(); alert('API è¨­å®šå·²å„²å­˜'); }

        // é›²ç«¯åŒæ­¥æ ¸å¿ƒé‚è¼¯
        async function uploadToCloud() {
            if(!db.apiUrl) return alert('è«‹å…ˆåœ¨è¨­å®šä¸­å¡«å…¥ API ç¶²å€');
            document.getElementById('sync-status').innerText = "é›²ç«¯åŒæ­¥ä¸­...";
            try {
                const response = await fetch(db.apiUrl, {
                    method: 'POST',
                    mode: 'no-cors', // è™•ç†è·¨ç¶²åŸŸå•é¡Œ
                    body: JSON.stringify(db)
                });
                alert('è³‡æ–™å·²æˆåŠŸä¸Šå‚³è‡³æ‚¨çš„ Google è©¦ç®—è¡¨ï¼');
            } catch(e) { alert('åŒæ­¥å¤±æ•—ï¼Œè«‹æª¢æŸ¥ API ç¶²å€èˆ‡éƒ¨ç½²æ¬Šé™'); }
            document.getElementById('sync-status').innerText = "æœ€å¾ŒåŒæ­¥æ—¥æœŸ: " + new Date().toLocaleTimeString();
        }

        async function downloadFromCloud() {
            if(!db.apiUrl) return alert('è«‹å…ˆåœ¨è¨­å®šä¸­å¡«å…¥ API ç¶²å€');
            try {
                const response = await fetch(db.apiUrl);
                const cloudData = await response.json();
                if(confirm('é€™å°‡æœƒè¦†è“‹ç›®å‰æ‰‹æ©Ÿä¸Šçš„æ‰€æœ‰è³‡æ–™ï¼Œç¢ºå®šé‚„åŸï¼Ÿ')) {
                    db = cloudData; save(); location.reload();
                }
            } catch(e) { alert('æŠ“å–å¤±æ•—ï¼Œè«‹ç¢ºèªé›²ç«¯æ˜¯å¦æœ‰è³‡æ–™ä¸” API æ­£ç¢º'); }
        }

        // --- éŒ„å–®åŠŸèƒ½ç©©å®šç‰ˆ (ç¢ºä¿æ‰‹æ©Ÿå¯ç”¨) ---
        function saveO() {
            const g = db.groups[db.activeGid]; const its = []; let tot = 0;
            g.products.forEach((p, i) => { 
                const qtyEl = document.getElementById('qty-'+i);
                const q = qtyEl ? parseInt(qtyEl.innerText) : 0; 
                if(q>0){ its.push({name:p.name, qty:q}); tot += p.price*q; } 
            });
            const name = document.getElementById('inName').value; if(!name) return alert('è«‹è¼¸å…¥è‡‰æ›¸åç¨±');
            const data = { id:editingOrderId||Date.now(), name, social:document.getElementById('inSocial').value, last:document.getElementById('inLast').value, payDate:document.getElementById('inPayDate').value, memo:document.getElementById('inMemo').value, items:its, itemsStr:its.map(i=>i.name+'x'+i.qty).join(','), price:tot, chk:'å°šæœªæ›´æ–°', ord:'å°šæœªæ›´æ–°' };
            if(editingOrderId){ const idx=g.orders.findIndex(x=>x.id==editingOrderId); g.orders[idx]=data; } else g.orders.push(data);
            save(); renderDetail(); closeModal('orderModal');
        }

        // å…¶å®ƒåŸæœ‰åŠŸèƒ½ (changeView, renderDashboard, renderDetail, toggleSidebar...) 
        // è¨˜å¾—ä¿ç•™ RWD å´é‚Šæ¬„èˆ‡ Modal é‚è¼¯
    </script>
</body>
</html>
